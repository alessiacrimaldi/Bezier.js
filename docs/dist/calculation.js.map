{"version":3,"file":"calculation.js","sources":["../../lib/calculation.js"],"sourcesContent":["import { Bezier } from \"./bezier.js\";\r\n\r\n\r\nexport function getLookUpTable(curve, steps = 100) {\r\n    curve.getLUT(steps);\r\n    return curve._lut;\r\n}\r\n\r\nexport function calculateLength(curve) {\r\n    return curve._curvelength = curve.length();\r\n}\r\n\r\nexport function getCurvePoint(curve, t, writeon) {\r\n    if (!writeon) {\r\n        return curve.get(t);\r\n    } else {\r\n        return curve._curvepoint = curve.get(t);\r\n    }\r\n}\r\n\r\nexport function calculateTangent(curve, t) {\r\n    var dv = curve.derivative(t);\r\n    dv.x *= (1 / (curve._t2 - curve._t1));\r\n    dv.y *= (1 / (curve._t2 - curve._t1));\r\n    return curve._derivative = dv;\r\n}\r\n\r\nexport function calculateTangents(curve, gap) {\r\n    var dv = [];\r\n    for (var t = 0, i = 0; t <= 1; t += gap, i++) {\r\n        dv[i] = curve.derivative(t);\r\n        dv[i].x *= (1 / (curve._t2 - curve._t1));\r\n        dv[i].y *= (1 / (curve._t2 - curve._t1));\r\n    }\r\n    return curve._derivatives = dv;\r\n}\r\n\r\nexport function calculateNormal(curve, t, writeoff) {\r\n    if (writeoff) {\r\n        return { x: curve.normal(t).x, y: curve.normal(t).y, t: t };\r\n    } else {\r\n        return curve._normal = { x: curve.normal(t).x, y: curve.normal(t).y, t: t };\r\n    }\r\n}\r\n\r\nexport function calculateNormals(curve, gap) {\r\n    var normals = [];\r\n    for (var t = 0, i = 0; t <= 1; t += gap, i++) {\r\n        normals[i] = { x: curve.normal(t).x, y: curve.normal(t).y, t: t };\r\n    }\r\n    return curve._normals = normals;\r\n}\r\n\r\nexport function splitCurve(curve, t1, t2) {\r\n    if (t2) {\r\n        return curve._subcurve = curve.split(t1, t2);\r\n    } else {\r\n        return curve._subcurves = [curve.split(t1).left, curve.split(t1).right];\r\n    }\r\n}\r\n\r\nexport function calculateCurveExtremas(curve) {\r\n    return curve._extremas = curve.extrema();\r\n}\r\n\r\nexport function calculateInflectionPoints(curve) {\r\n    return curve._inflectionpoints = curve.inflections();\r\n}\r\n\r\nexport function calculateCurvature(curve, t) {\r\n    return curve._curvature = { k: curve.curvature(t).k, r: curve.curvature(t).r, t: t };\r\n}\r\n\r\nexport function calculateCurvatures(curve, gap = 2) {\r\n    var kr = [];\r\n    for (var s = 0, i = 0; s < 256; s += gap, i++) {\r\n        let t = s / 255;\r\n        kr[i] = { k: curve.curvature(t).k, r: curve.curvature(t).r, t: t };\r\n    }\r\n    return curve._curvatures = kr;\r\n}\r\n\r\nexport function calculateBoundingBox(curve) {\r\n    return curve._boundingbox = curve.bbox();\r\n}\r\n\r\nexport function calculateHullPoints(curve, t) {\r\n    return curve._hullpoints = curve.hull(t);\r\n}\r\n\r\nexport function calculateClosestPoint(curve, point) {\r\n    return curve._projectpoint = curve.project(point);\r\n}\r\n\r\nexport function calculateOffset(curve, d, t) {\r\n    if (t) {\r\n        return curve._offsetpoint = curve.offset(t, d);\r\n    } else {\r\n        return curve._offsetcurves = curve.offset(d);\r\n    }\r\n}\r\n\r\nexport function calculateReducedCurve(curve) {\r\n    return curve._reducedcurves = curve.reduce();\r\n}\r\n\r\nexport function calculateArcs(curve, threshold = 0.5) {\r\n    return curve._arcs = curve.arcs(threshold);\r\n}\r\n\r\nexport function calculateScaledCurve(curve, reduced) {\r\n    var scaledCurves = [];\r\n    for (var d = -30, k = 0; d <= 30; d += 10, k++) {\r\n        scaledCurves[k] = reduced.scale(d);\r\n    }\r\n    return curve._scaledcurves = scaledCurves;\r\n}\r\n\r\nexport function calculateOutline(curve, d1, d2, d3, d4) {\r\n    if (d4) {\r\n        return curve._outline = curve.outline(d1, d2, d3, d4);\r\n    } else if (d3) {\r\n        return curve._outline = curve.outline(d1, d2, d3);\r\n    } else if (d2) {\r\n        return curve._outline = curve.outline(d1, d2);\r\n    } else {\r\n        return curve._outline = curve.outline(d1);\r\n    }\r\n}\r\n\r\nexport function calculateShapedOutline(curve, d1, d2, threshold) {\r\n    if (threshold) {\r\n        return curve._shapedoutline = curve.outlineshapes(d1, d2, threshold);\r\n    } else if (d2) {\r\n        return curve._shapedoutline = curve.outlineshapes(d1, d2);\r\n    } else {\r\n        return curve._shapedoutline = curve.outlineshapes(d1);\r\n    }\r\n}\r\n\r\nexport function calculateIntersection(curve, other, threshold = 0.5) {\r\n    if (other) {\r\n        if (other instanceof Bezier) {\r\n            return curve._intersection = curve.intersects(other, threshold);\r\n        } else {\r\n            return curve._intersection = curve.intersects(other);\r\n        }\r\n    } else {\r\n        if (curve.order == 2) {\r\n            return curve._intersection = \"no self intersection\";\r\n        } else if (curve.order == 3) {\r\n            return curve._intersection = curve.intersects();\r\n        }\r\n    }\r\n}\r\n\r\n// utils\r\nexport function getOffsetCurve(curve, a, b) {\r\n    if (b) {\r\n        return curve.offset(a, b);\r\n    } else {\r\n        return curve.offset(a);\r\n    }\r\n}"],"names":["getLookUpTable","curve","steps","calculateLength","getCurvePoint","t","writeon","calculateTangent","dv","calculateTangents","gap","i","calculateNormal","writeoff","calculateNormals","normals","splitCurve","t1","t2","calculateCurveExtremas","calculateInflectionPoints","calculateCurvature","calculateCurvatures","kr","s","calculateBoundingBox","calculateHullPoints","calculateClosestPoint","point","calculateOffset","d","calculateReducedCurve","calculateArcs","threshold","calculateScaledCurve","reduced","scaledCurves","k","calculateOutline","d1","d2","d3","d4","calculateShapedOutline","calculateIntersection","other","Bezier","getOffsetCurve","a","b"],"mappings":"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"}